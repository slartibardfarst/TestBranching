Here the original code from the old master

some fix for issue 53